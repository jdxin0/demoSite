
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>慧学网络</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta charset="UTF-8" name="description" content="">
	<meta name="keywords" content="">
	<!-- html头信息修改 -->
    <link rel="stylesheet" href="css/swiper.min.css">
    <link rel="stylesheet" href="css/webuploader.css">
    <link rel="stylesheet" href="css/spectrum.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/tpl.css">
	<link rel="stylesheet" href="css/jquery.Jcrop.min.css">
    <link rel="stylesheet" href="css/bootstrap-paginator.css">
	<script src="js/jquery-2.1.4.min.js"></script>
	<script type="js/jquery.slides.min.js"></script>
	<script src="js/swiper.min.js"></script>
	<script type="text/javascript" src="js/bootstrap-paginator.min.js"></script>
    <script type="text/javascript" src="js/jquery.lazyload.min.js"></script>
</head>
<body class="webapp">
<!-- 导航 -->
<link rel="stylesheet" href="http://cdn.jisuapp.cn/zhichi_frontend/static/webapp_home/css/nav.css?version=10303">
<div class="nav-wrap">
	<div class="nav-logo nav-logo-img">
		<h1>微信小程序、小程序开发</h1>
	</div>
	<ul class="top-menu">
		<li class="menu-one">
			<a href="javascript:;" target="_blank">微页</a>
		</li>
		<li class="menu-one">
			<a href="javascript:;" target="_blank">开发论坛</a>
		</li>
		<li class="menu-one">
			<a class="serve" href="#">服务<span class="serve_ico"></span></a>					
			<ul style="width: 100%">
				<li class="menu-two"><a href="javascript:;" target="_blank">功能介绍</a></li>
				<li class="menu-two"><a href="javascript:;" target="_blank">成为代理</a></li>
				<li class="menu-two check_login">服务支持</li>
				<li class="menu-two"><a href="javascript:;" target="_blank">媒体报导</a></li>
				<li class="menu-two"><a href="javascript:;" target="_blank">代理查询</a></li>
				<li class="menu-two"><a href="javascript:;" target="_blank">设计大赛</a></li>
			</ul>
		</li>
		<li class="menu-one">
			<a href="javascript:;">案例</a>
		</li>
		<li class="menu-one">	
			<a>官方定制</a>
		</li>
		<li class="menu-one check_login" >
			应用管理
		</li>
		<li class="menu-one">
			<a href="javascript:;">小程序制作</a>
		</li>
		<li class="menu-one">
			<a href="javascript:;">首页</a>
		</li>
	</ul>
	<div class="nav-login">
		<p class="login-span-wrap"><span class="nav-lglogin">登录</span><span class="nav-reg">注册</span></p>
	</div>
</div>
	<script src="http://cdn.jisuapp.cn/zhichi_frontend/static/webapp_home/js/nav.js"></script>
	<link rel="stylesheet" href="http://cdn.jisuapp.cn/zhichi_frontend/static/webapp_home/css/app_login_reg.css?version=10303">
	<script type="text/javascript" src="http://cdn.jisuapp.cn/zhichi_frontend/static/pc2/common/js/jquery.md5.js"></script>
	<script type="text/javascript" src="http://cdn.jisuapp.cn/zhichi_frontend/static/pc2/common/js/cookie.js"></script>
	<script type="text/javascript" src="http://cdn.jisuapp.cn/zhichi_frontend/static/webapp_home/js/app_login_reg.js?version=10303"></script>


	<div id="slides">
		<a><img src="imgs/1.jpg" alt=""></a>
		<a ><img src="imgs/2.png" alt=""></a>
		<a ><img src="imgs/3.jpg" alt=""></a>
		<a ><img src="imgs/4.jpg" alt=""></a>
		<div class="slidesjs-previous slidesjs-navigation swiper-button-prev"></div>
		<div class="slidesjs-next slidesjs-navigation swiper-button-next"></div>
	</div>
		
	<script type="text/javascript">
		$('#slides').css('height',$(window).width() / 1920 * 296 );
		$(window).resize(function(){
			$('#slides').css('height',$(window).width() / 1920 * 296 );
		});
	</script>
	    <div class="swiper-pagination"></div>
	    <div class="swiper-button-prev"></div>
	    <div class="swiper-button-next"></div>
	<div class="tpl-navs-wrap">
		<div class="tpl-first-navs" id="first-navs">
            <span data-cate="1" class="active">常用</span>
        	<span data-cate="12" class="js-uninitial">单页</span>
    	</div>
		<div class="tpl-pay-select">
        	<span class="active" id="tpl-all-btn">全部</span>
        	<span  id="tpl-free-btn">免费</span>
		</div>
	</div>
<div class="tpl-content active">
    <div class="tpl-sec-navs">
	 	<span data-cate="0" class="active">全部</span>
        <span data-cate="41" class="">多商家</span>
        <span data-cate="25" class="">电商</span>
        <span data-cate="17" class="">美食</span>
        <span data-cate="19" class="">婚庆</span>
        <span data-cate="23" class="">房产</span>
        <span data-cate="24" class="">鲜花</span>
        <span data-cate="34" class="">酒店</span>
        <span data-cate="36" class="">KTV</span>
        <span data-cate="44" class="">社会</span>
        <span data-cate="45" class="">超市</span>
        <span data-cate="51" class="">公司</span>
        <span data-cate="18" class="">珠宝</span>
        <span data-cate="20" class="">旅游</span>
        <span data-cate="21" class="">运动</span>
        <span data-cate="22" class="">美容</span>
        <span data-cate="26" class="">家居</span>
        <span data-cate="27" class="">果蔬</span>
        <span data-cate="28" class="">医药</span>
        <span data-cate="29" class="">母婴</span>
        <span data-cate="30" class="">教育</span>
        <span data-cate="31" class="">摄影</span>
        <span data-cate="33" class="">社区</span>
        <span data-cate="37" class="">汽车</span>
        <span data-cate="39" class="">资讯</span>
        <span data-cate="40" class="">金融</span>
        <span data-cate="43" class="">家政</span>
        <span data-cate="46" class="">票务</span>
        <span data-cate="47" class="">洗浴</span>
        <span data-cate="49" class="">工具</span>
        <span data-cate="54" class="">保险</span>
	</div>
    <ul class="tpl-container">
            <li class="empty-tpl" data-id="-1">
                <div class="note-icon"></div>
                <p class="name">空白模板</p>
            </li>
        
             
    </ul>
</div>

<script type="text/javascript">
	$(document).ready(function(){
          	$(document).scroll(function(){
          		var DOMheight = $(this).height();  
          		var scroll_top = $(this).scrollTop();
          		var screenHeight = $(window).height();
          		console.log(screenHeight+scroll_top);
          		if (screenHeight+scroll_top>=DOMheight) {
          			 	    $.ajax({
             	  	    	url:"http://test.scpoo.com/myTools/public/index.php/base/getApps",
             	  	    	dataType:"json",
             	  	    	success:function(rs){
             	  	    		console.log(rs)
             	  	    		if(rs.ret==0){
             	  	    			var data=rs.data;
          				        var tplArr=[];
          				    for(var x=0;x<data.length;x++){
          					tplArr.push(
          								[' <li class="js-tpl">',
          								'                    <img alt="" class="cover lazy" src="'+data[x].pc_pic+'">',
          								'                    <p class="name">'+data[x].title+'</p>',
          								'                    <div class="code-mask">',
          								'                        <img src="'+data[x].pc_qcode+'" alt="" class="code">',
          								'                        <span class="select-btn choose-btn">使用</span>',
          								'                        <span class="select-btn js-preview-btn">预览</span>',
          								'                    </div>',
          								'</li>'].join(""));

          				};
          				$(".tpl-content").find("ul").append(tplArr.join(""));
          			}
          		}
          	});
          		}
          	});
});

</script>
<!--    <script type="text/javascript">
   	  $(document).ready(function(){
   	  	    $.ajax({
   	  	    	url:"http://test.scpoo.com/myTools/public/index.php/base/getApps",
   	  	    	dataType:"json",
   	  	    	success:function(rs){
   	  	    		console.log(rs)
   	  	    		if(rs.ret==0){
   	  	    			var data=rs.data;
				        var tplArr=[];
				    for(var x=0;x<data.length;x++){
					tplArr.push(
								[' <li class="js-tpl">',
								'                    <img alt="" class="cover lazy" src="'+data[x].pc_pic+'">',
								'                    <p class="name">'+data[x].title+'</p>',
								'                    <div class="code-mask">',
								'                        <img src="'+data[x].pc_qcode+'" alt="" class="code">',
								'                        <span class="select-btn choose-btn">使用</span>',
								'                        <span class="select-btn js-preview-btn">预览</span>',
								'                    </div>',
								'</li>'].join(""));

				};
				$(".tpl-content").find("ul").append(tplArr.join(""));
			}
		}
	});
});

   </script>
 -->



    <div class="nav_top">
      <span class="nav_help">
      <a href="http://bbs.zhichiwangluo.com/forum.php?mod=viewthread&tid=11085&extra=page%3D1%26filter%3Dtypeid%26typeid%3D39" target="_blank">
      <span class="use"><svg class=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/zhichi_frontend/static/pc/index/symbol-svg/symbol-btn.svg#icon-help" /></svg></span>
      </a>
      <div class="help_con">
        <p>新手入门教程</p>
	   </div>
      </span>
        <span style="margin: 1px 0;" class="nav_video">
      <a href="http://bbs.zhichiwangluo.com/plugin.php?id=tpgao_edu:view&typeid=12&cpid=8&courseid=1" target="_blank">
      <span class="use"><svg class=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/zhichi_frontend/static/pc/index/symbol-svg/symbol-btn.svg#icon-video" /></svg></span>
      </a>
      <div class="video_con">
        <p>最新视频教程</p>
      </div>
      </span>
        <span class="scrollTop use"><svg class=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/zhichi_frontend/static/pc/index/symbol-svg/symbol-btn.svg#icon-top" /></svg></span>
    </div>
    <!-- 高级版试用弹窗
    
<link rel="stylesheet" type="text/css" href="http://cdn.jisuapp.cn/zhichi_frontend/static/webapp_home/css/enterprise.css">
<div class="advancedContainer" id="advanced-container">
<div class="main">
	<div class="premium-left">
		<img src="http://cdn.jisuapp.cn/zhichi_frontend/static/webapp_home/img/premium.jpg" alt="" style="width: 370px">
	</div>
	<div class="premium-right">
		<div class="submenu ">
			<p style="font-size: 24px">小程序高级版&nbsp;<span style="color: #ff3f1d;">￥3999/年</span>
			<span style="font-size: 16px;margin-left: 5px;">（有效期7天）</span></p>
		</div>
		<div class="msg">
			<div style="border-bottom: 1px solid #666666">
			<lable>姓名：</lable>
		   <input type="text" id="name">
			</div>
			<div style="border-bottom: 1px solid #666666">
			<lable>电话：</lable>
			 <input type="text" id="telephone">
			</div>
			<div style="border-bottom: 1px solid #666666">
			<lable>公司名称：</lable>
			<input type="text" id="company">
			</div>
			<div style="border-bottom: 1px solid #666666">
			<lable>职称：</lable>
			<input type="text" id="technicalTitle">
			</div>
		</div>
		<div class="advanced-button">
			<button style= "width: 314px;height: 37px;background-color: #37b7eb;font-size: 16px;margin-top: 30px;
			color: white;margin-top: 42px;border: none;">立即试用</button>

		</div>
	</div>

</div>
</div>
<script type="text/javascript" src="http://cdn.jisuapp.cn/zhichi_frontend/static/webapp_home/js/enterprise.js"></script>
    <!--高级版试用弹窗  完 -->
	<!-- 创建APP end-->
	<script src="http://cdn.jisuapp.cn/zhichi_frontend/static/pc2/common/js/webuploader.nolog.min.js"></script>
	<script src="http://cdn.jisuapp.cn/zhichi_frontend/static/pc2/common/js/jquery.Jcrop.min.js"></script>
	<script src="http://cdn.jisuapp.cn/zhichi_frontend/static/pc/invitation/spectrum/spectrum.js"></script>
	<script src="http://cdn.jisuapp.cn/zhichi_frontend/static/pc2/common/js/common.js"></script>
	<script src="http://cdn.jisuapp.cn/zhichi_frontend/static/pc/invitation/js/tip.js"></script>
	<script src="http://cdn.jisuapp.cn/zhichi_frontend/static/pc2/common/js/qrcode.js?version=10303"></script>
	<script src="http://cdn.jisuapp.cn/zhichi_frontend/static/webapp/js/tpl.js"></script>
	<link rel="stylesheet" href="http://cdn.jisuapp.cn/zhichi_frontend/static/pc2/common/css/jquery.Jcrop.min.css">
<style rel="stylesheet">

.webapp-box {
  position: fixed;
  -webkit-transform: translateX(-10000px);
  -moz-transform: translateX(-10000px);
  transform: translateX(-10000px);
  z-index: 1001;
  left: 50%;
  top: 10%;
  width: 603px;
  min-height: 460px;
  margin-left: -300px;
  padding-bottom: 15px;
  border: 1px solid #DDD;
  border-radius: 10px;
  box-shadow: 5px 5px 20px rgba(0,0,0,.4),-5px -5px 20px rgba(0,0,0,.4);
  background: #FFF;
}
.webapp-box.animate-show {
  -webkit-animation: 'show' .5s linear;
  -moz-animation: 'show' .5s linear;
  animation: 'show' .5s linear;
}
.webapp-box.animate-hide {
  -webkit-animation: 'hide' .3s linear;
  -moz-animation: 'hide' .3s linear;
  animation: 'hide' .3s linear;
}
.webapp-box-bg {
  position: fixed;
  -webkit-transform: translateX(-10000px);
  -moz-transform: translateX(-10000px);
  transform: translateX(-10000px);
  width: 100%;
  height: 100%;
  z-index: 1000;
  left: 0;
  top: 0;
  background: rgba(0,0,0,.5);
}
.animate-show {
  -webkit-transition: opacity .5s linear;
  -moz-transition: opacity .5s linear;
  transition: opacity .5s linear;
  opacity: 1;
}
.animate-hide {
  -webkit-transition: opacity .5s linear;
  -moz-transition: opacity .5s linear;
  transition: opacity .5s linear;
  opacity: 0;
}
.webapp-box-bg.animate-show, .webapp-box.animate-show {
  -webkit-transform: translateX(0px);
  -moz-transform: translateX(0px);
  transform: translateX(0px);
}

@-webkit-keyframes 'show'{
  0%{opacity:.1}
  60%{opacity:.85;-webkit-transform:scale(1.01,1.01)}
  85%{opacity:1;-webkit-transform:scale(0.99,0.99)}
  100%{-webkit-transform:scale(1,1)}
}
@-moz-keyframes 'show'{
  0%{opacity:.1}
  60%{opacity:.85;-moz-transform:scale(1.01,1.01)}
  85%{opacity:1;-moz-transform:scale(0.99,0.99)}
  100%{-moz-transform:scale(1,1)}
}
@keyframes 'show'{
  0%{opacity:.1}
  60%{opacity:.85;transform:scale(1.01,1.01)}
  85%{opacity:1;transform:scale(0.99,0.99)}
  100%{transform:scale(1,1)}
}

@-webkit-keyframes 'hide'{
  0%{-webkit-transform:scale(1,1);opacity:1}
  35%{-webkit-transform:scale(1.02,1.02);opacity:.5}
  70%{-webkit-transform:scale(1.05,1.05);opacity:.2}
  100%{-webkit-transform:scale(1,1);opacity:0}
}
@-moz-keyframes 'hide'{
  0%{-moz-transform:scale(1,1);opacity:1}
  35%{-moz-transform:scale(1.02,1.02);opacity:.5}
  70%{-moz-transform:scale(1.05,1.05);opacity:.2}
  100%{-moz-transform:scale(1,1);opacity:0}
}
@keyframes 'hide'{
  0%{transform:scale(1,1);opacity:1}
  35%{transform:scale(1.02,1.02);opacity:.5}
  70%{transform:scale(1.05,1.05);opacity:.2}
  100%{transform:scale(1,1);opacity:0}
}
.webapp-box input[type=file]:focus, .webapp-box input[type=checkbox]:focus, .webapp-box input[type=radio]:focus {
  outline: none;
}


.webapp-box-header {
/*  position: absolute;
  top: 0;
  left: 0;
  z-index: 2;*/
  width: 100%;
  height: 45px;
  background: #FFF;
  border-bottom: 1px solid #e5e5e5;
  border-radius: 10px 10px 0 0;
}
.webapp-box-header-ul {
  margin: 12px 0 0 10px;
  padding: 0;
  font-size: 0;
  text-align: center;
}
.webapp-box-header-ul li {
  display: inline-block;
  padding: 5px 16px;
  cursor: pointer;
  font-size: 14px;
  border-top: 1px solid #ddd;
  border-bottom: 1px solid #ddd;
}
.webapp-box-header-ul li:first-child {
  border-top-left-radius: 5px;
  border-bottom-left-radius: 5px;
  border-left: 1px solid #ddd;
}
.webapp-box-header-ul li:last-child {
  border-top-right-radius: 5px;
  border-bottom-right-radius: 5px;
  border-right: 1px solid #ddd;
}
.webapp-box-header-ul li.active {
  background: #00a3e9;
  color: #FFF;
}
.webapp-box-close {
  position: absolute;
  top: 15px;
  right: 20px;
  cursor: pointer;
  font-size: 2.1rem;
  font-weight: bold;
  line-height: 1;
  color: #000;
  text-shadow: 0 1px 0 #fff;
  opacity: .2;
}
.webapp-box-content {
  /*position: relative;*/
  /*box-sizing: border-box;*/
  /*padding: 55px 0 50px;*/
  width: 100%;
  /*height: 100%;*/
  background: #FFF;
  border-radius: 15px;
}
.box-hide {
  display: none;
}
.webapp-box-content .box-resource-content {
  display: none;
}
.webapp-box-content .webapp-content-tab {
  padding-left: 10px;
  margin: 0;
  max-height: 140px;
  overflow-y: auto;
}
.webapp-box-content .webapp-content-tab li {
  display: inline-block;
  padding: 5px 14px;
  margin: 5px 0;
  cursor: pointer;
}
.webapp-box-content .webapp-content-tab li.active {
  border-radius: 6px;
  background: #00a3e9;
  color: #FFF;
}
.webapp-box-content .content-top-operation {
/*  position: absolute;
  bottom: 49px;
  left: 0;
  right: 0;*/
  background: #f7f7f7;
  padding: 8px;
}
.webapp-box-content .content-top-operation ul {
  margin: 0;
  padding: 0;
}
.content-top-operation .box-operation-menu li {
  margin-right: 5px;
}
#webapp-img-box .resource-list-wrap {
/*  position: absolute;
  top: 100px;
  bottom: 100px;
  left: 0;
  right: 0;*/
  display: none;
  height: 290px;
  /*width: 100%;*/
  padding-left: 15px;
  padding-top: 8px;
  overflow-x: hidden;
  overflow-y: auto;
}
#webapp-img-box .resource-list li {
  display: inline-block;
  margin: 0 15px 15px 0;
  position: relative;
  border: 1px solid transparent;
}
#webapp-img-box .resource-list li:hover,
#webapp-img-box .resource-list li.selected {
  border-color: #ccc;
}
#webapp-img-box .resource-list li:hover {
  background-color: #ddd;
}
#webapp-img-box .resource-list li.selected:after {
  position: absolute;
  right: -12px;
  top: -10px;
  display: block;
  width: 24px;
  height: 24px;
  content: '√';
  color: #fff;
  font-family: "微软雅黑";
  line-height: 22px;
  text-align: center;
  border: 2px solid #fff;
  background: #6abb03;
  border-radius: 50%;
}
/*.webapp-box-content .resource-list .img-title {
  width: 72px;
  height: 24px;
  line-height: 24px;
  margin: 0;
  font-size: 12px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}*/
#webapp-img-box .resource-list .img-operate {
  display: none;
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1;
}
#webapp-my-img .resource-list li:hover .img-operate,
body[data-admin="1"] #webapp-system-img li:hover .img-operate,
body[admin="1"] #webapp-system-img li:hover .img-operate {
  display: block;
}
#webapp-img-box .resource-list .img-operate a {
  display: table-cell;
  width: 1%;
  padding: 2px;
  text-align: center;
  color: #fff;
  font-size: 12px;
  text-decoration: none;
  background-color: rgba(0,0,0,.5);
}
#webapp-img-box .resource-list .img-operate a:hover {
  background-color: rgba(0,0,0,.8);
}
#webapp-img-box .resource-list .progress-mask {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0,0,0,.8);
  z-index: 2;
  padding-top: 30px;
  color: #fff;
  text-align: center;
  font-size: 16px;
}
#webapp-img-box .resource-list .upload-fail-tip {
  display: none;
}
.webuploader-container {
  position: relative;
}
.webapp-box-footer {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 50px;
  line-height: 40px;
  padding-right: 30px;
  border-radius: 0 0 10px 10px;
  background: #FFF;
  border-top: 1px solid #e5e5e5;
  z-index: 2;
  font-size: 12px;
}
#img-crop-box .webapp-box-footer {
  text-align: right;
}
.webapp-box .webuploader-pick {
  font-size: inherit !important;
  background-color: transparent;
  overflow: initial;
}
.webapp-box .resource-select-num {
  color: #0034FF;
}
.webapp-box .form-control {
  display: inline-block;
  width: 120px;
}
.webapp-box .progress-bar {
  position: absolute;
  left: 365px;
  top: 20px;
}
.webapp-box .thumbnail {
  display: inline-block;
  width: 80px;
  height: 80px;
  margin: 0;
  text-align: center;
  font-size: 0;
  border: none;
}
.webapp-box .thumbnail:before, .webapp-box .thumbnail:after {
  content: "";
  display: inline-block;
  width: 0;
  height: 100%;
  vertical-align: middle;
}
.webapp-box .thumbnail img {
  display: inline-block;
  max-width: 100%;
  max-height: 100%;
  vertical-align: middle;
}
#img-crop-box {
  width: 700px;
  height: 500px;
  margin-left: -350px;
}
.img-crop-scope {
  width: 508px;
  height: 320px;
  margin-top: 20px;
  text-align: center;
  font-size: 0;
  border: 1px solid #bbb;
  background-color: #ccc;
  overflow: hidden;
}
.img-crop-top-input {
  padding: 7px 10px;
  background-color: #eee;
}
.jcrop-holder > input[type="radio"] {
  left: -2000px !important;
}
.webapp-sub-cate {
  display: none;
  padding: 8px 15px;
}
.webapp-sub-cate > span {
  cursor: pointer;
  margin-right: 8px;
  padding-right: 8px;
  border-right: 1px solid;
  color: #6c6c6c;
}
.webapp-sub-cate > span.active {
  color: #00a3e9;
}
.img-box-ui-radio {
  display: inline-block;
  width: 22px;
  height: 22px;
  position: relative;
  overflow: visible;
  border: 0;
  background: 0 0;
  -webkit-appearance: none;
  outline: 0;
  vertical-align: middle;
}
.img-box-ui-radio:before {
  content: '';
  display: block;
  width: 16px;
  height: 16px;
  border: 2px solid #dfe0e1;
  border-radius: 16px;
  background-clip: padding-box;
  position: absolute;
  left: 0;
  top: 0;
}
.img-box-ui-radio:checked:before {
  border: 2px solid #18b4ed;
}
.img-box-ui-radio:after {
  content: '';
  display: block;
  width: 8px;
  height: 8px;
  background: #dfe0e1;
  border-radius: 8px;
  position: absolute;
  left: 6px;
  top: 6px;
}
.img-box-ui-radio:checked:after {
  background: #18b4ed;
}
.img-crop-body-left {
  float: left;
  padding: 10px;
  margin: 0 20px;
  border: 1px solid #eee;
}
.img-crop-body-left label {
  display: block;
  padding: 0 8px;
  margin: 16px 0;
  text-align: right;
}
.img-crop-body-left .img-box-ui-radio {
  margin-left: 10px;
}
.webapp-box .btn {
  display: inline-block;
  padding: 6px 12px;
  width: auto;
  font-size: 14px;
  line-height: 18px;
  border: 1px solid #ccc;
  border-radius: 3px;
  color: #666;
  background-color: #fff;
  cursor: pointer;
  vertical-align: middle;
}
.webapp-box .btn.green {
  color: #fff;
  background-color: #03d8a2;
  border-color: #05C897;
}
.webapp-box .btn.orange {
  color: #fff;
  background-color: #ff9f22;
  border-color: #ee9016;
}
.webapp-box .btn.blue {
  color: #fff;
  background-color: #1dc6f1;
  border-color: #15bbe5;
}
.webapp-box input[type="text"] {
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  line-height: 14px;
  padding: 6px;
  box-shadow: inset 0 1px 3px rgba(0,0,0,.2);
  outline: 0;
  -webkit-user-select: text;
}
.webapp-box select {
  border: 1px solid #ccc;
  border-radius: 4px;
  line-height: 14px;
  padding: 6px 4px 6px 6px;
  box-shadow: inset 0 2px 8px rgba(0,0,0,.2);
  outline: 0;
  width: 160px;
  margin: 0;
}
input[type="file"]{
  opacity: 0;
}
</style>
<div class="webapp-box-bg" id="webapp-img-box-bg"></div>
<div class="webapp-box" id="webapp-img-box">
    <div class="webapp-box-header">
        <div>
            <div>
                <ul class="webapp-box-header-ul">
                    <li>我的图片</li>
                    <li class="system-img-library">图片库</li>
                </ul>
            </div>
        </div>
        <span class="webapp-box-close">×</span>
    </div>
    <div class="webapp-box-content">
        <div class="box-resource-content" id="webapp-my-img">
            <div>
                <ul class="webapp-content-tab">
                    <li data-page="1" data-id="0" id="default-img-group">全部</li>
                </ul>
                <div class="resource-list-wrap">
                    <ul class="resource-list"></ul>
                </div>
            </div>
        </div>
        <div class="box-resource-content" id="webapp-system-img">
            <ul class="webapp-content-tab">
              <li data-page="1" data-id="0">全部</li>
            </ul>
            <div class="resource-list-wrap">
                <ul class="resource-list"></ul>
            </div>
        </div>
        <div class="content-top-operation">
            <div class="box-operation-menu">
                <ul>
                    <li class="btn btn-success green" id="select-local-img">上传至当前组</li>
                    <li class="btn btn-default" data-href="#img-box-group-create">新建分组</li>
                    <li class="btn btn-default cannot-operate-default edit-img-group" data-href="#img-box-group-edit">编辑分组</li>
                    <li class="btn btn-default img-batch" data-href="#box-img-batch">批量处理</li>
                </ul>
            </div>
            <div class="box-hide" id="img-box-group-edit">修改组名 <input class="group-name-input form-control input" type="text">
                <a href="javascript:;" class="btn btn-success green group-edit-confirm">确定</a>
                <a href="javascript:;" class="btn btn-default group-edit-cancel">取消</a>
                <a href="javascript:;" class="btn btn-danger orange delete-img-group">删除当前组</a>
            </div>
            <div class="box-hide" id="img-box-group-create">新建分组 <input class="group-name-input form-control input" type="text">
                <a href="javascript:;" class="btn btn-success green group-edit-confirm">确定</a>
                <a href="javascript:;" class="btn btn-default group-edit-cancel">取消</a>
                <span>组名不超过6个字</span>
            </div>
            <div class="box-hide" id="box-img-batch">已选<span class="resource-select-num">0</span>张
                移至 <select class="resource-group-select form-control"></select>
                <a href="javascript:;" class="btn btn-success green group-edit-confirm">确定</a>
                <a href="javascript:;" class="btn btn-danger orange delete-select-img">删除选中图片</a>
                <a href="javascript:;" class="btn btn-default group-edit-cancel">取消</a>
            </div>
        </div>
    </div>
<!--     <div class="webapp-box-footer">
        <a href="javascript:;" class="btn blue img-box-confirm">确定</a>
    </div> -->
</div>
<div class="webapp-box-bg" id="img-crop-box-bg"></div>
<div class="webapp-box" id="img-crop-box">
  <div class="webapp-box-header">
    <div class="webapp-box-header-ul">
      <span style="font-size:16px;">图片裁剪</span> 
    </div>
    <span class="webapp-box-close">×</span>
  </div>
  <div class="webapp-box-content">
    <div class="form-inline img-crop-top-input">
      <span>宽度: </span><input class="form-control input-sm input img-crop-width-input" type="text">
      <span>高度: </span><input class="form-control input-sm input img-crop-height-input" type="text">
    </div>
    <div class="img-crop-body">
      <div class="img-crop-body-left">
        <label>原图比例<input class="img-box-ui-radio" data-ratio="1" type="radio" name="img-box-ratio"></label>
        <label>1:1<input class="img-box-ui-radio" data-ratio="1" type="radio" name="img-box-ratio"></label>
        <label>4:3<input class="img-box-ui-radio" data-ratio="4/3" type="radio" name="img-box-ratio"></label>
        <label>3:4<input class="img-box-ui-radio" data-ratio="3/4" type="radio" name="img-box-ratio"></label>
        <label>16:9<input class="img-box-ui-radio" data-ratio="16/9" type="radio" name="img-box-ratio"></label>
        <label>自由拖动<input class="img-box-ui-radio" data-ratio="0" type="radio" name="img-box-ratio"></label>
      </div>
      <div class="img-crop-body-right">
        <div class="img-crop-scope">
            <img id="img-crop-target">
        </div>
      </div>
    </div>
  </div>
  <div class="webapp-box-footer">
    <button class="btn btn-info blue img-crop-cancel">不裁剪</button>
    <button class="btn btn-success green img-crop-confirm">裁剪</button>
    <button class="btn btn-default img-crop-return" style="margin-left:50px;">取消</button>
  </div>
</div>    
<script>
/**
 * 图片上传
 */
var jcropApiIns, // 图片裁剪实例
    jcropSelectPos, $img_box_replacer, afterSelectImgCallback, img_box_scrollTimer, img_box_inputTimer;

$('#img-crop-target').Jcrop({
  boxWidth : $('.img-crop-scope').width(),
  boxHeight: $('.img-crop-scope').height(),
  aspectRatio: 1/1,
  onSelect: function(){
    jcropSelectPos = jcropApiIns.tellSelect();
  },
  onChange: function(c){
    var $tracker = $('.jcrop-tracker');
    $('.img-crop-width-input').val(Math.round(c.w));
    $('.img-crop-height-input').val(Math.round(c.h));
  }
}, function(){
  jcropApiIns = this;
  jcropApiIns.setSelect([0, 0, 100, 100]);
});

$('#webapp-img-box').on('click', '.webapp-box-header-ul li', function(){
  // 我的图片/图片库 切换
  if($(this).hasClass('active')) { return; }
  var index = $(this).index(),
      $content = $('#webapp-img-box .box-resource-content').eq(index),
      $li = $content.find('.webapp-content-tab li'),
      $subCate;

  $(this).addClass('active').siblings().removeClass('active');
  $content.show().siblings('.box-resource-content').hide();
  if (!$li.filter('.active').length){
    $li.eq(0).trigger('click');
  } else {
    $li.filter('.active').trigger('click');
  }
  if($(this).hasClass('system-img-library')){
    if($('body').attr('data-admin') || $('body').attr('admin')){
      $('#webapp-img-box .content-top-operation').show();
    }else {
      $('#webapp-img-box .content-top-operation').hide();
    }
  } else {
    $('#webapp-img-box .content-top-operation').show();
  }
  $('#webapp-img-box .group-edit-cancel:visible').trigger('click');
}).on('click', '.webapp-box-close', function(){
// 关闭资源框
  $('#webapp-img-box, #webapp-img-box-bg').addClass('animate-hide').removeClass('animate-show');

}).on('click', '.webapp-content-tab li', function(){
// 一级菜单切换
  var index = $(this).index(),
      $content = $(this).parent().siblings('.resource-list-wrap').eq(index),
      $subCate;

  $(this).addClass('active').siblings('.active').removeClass('active');
  $content.show().siblings('.resource-list-wrap').hide();
  $('#webapp-img-box .resource-list .selected').removeClass('selected');
  $('.resource-select-num').text(0);

  if( ($subCate = $(this).parent().siblings('.webapp-sub-cate[data-href='+$(this).attr('data-id')+']')).length){
  // 如果有一级菜单下有二级菜单时 展示二级菜单, data-page为1 表示该列表没有请求过数据 点击二级菜单请求数据
    $subCate.show().siblings('.webapp-sub-cate').hide();
    if ($(this).attr('data-page') == 1) {
      $(this).attr('data-page', 2);
      $subCate.children().eq(0).trigger('click');
    }
  } else {
  // 没有二级菜单 直接点击一级菜单请求数据
    $('.webapp-sub-cate').hide();
    if ($(this).attr('data-page') == 1) {
      getImgResource('image', $(this), $content.find('.resource-list'));
    }
  }
}).on('click', '.webapp-sub-cate > span', function(){
// 二级菜单切换
  $(this).attr('data-page', 1).addClass('active').siblings('.active').removeClass('active');
  $('#webapp-img-box .resource-list-wrap:visible').off('scroll').on('scroll', function(){
    webappImgBoxScroll($(this));
  });
  getImgResource('image', $(this), $('.resource-list:visible'));

}).on('click', '.resource-list li', function(){
  // 选中图片
  if($(this).hasClass('resource-uploading')){ return; }
  if($('#box-img-batch:visible').length){
    $(this).toggleClass('selected');
    $('.resource-select-num').text($('#webapp-img-box .resource-list li.selected').length);
  } else {
    var $img = $(this).find('img'),
        imgsrc = $img.attr('src'),
        ratio  = $img.width()/$img.height();

    $('#webapp-img-box .selected').removeClass('selected');
    $(this).addClass('selected');
    $('#img-crop-target').attr({
      'src': imgsrc,
      'data-id': $(this).attr('data-id')
    });

    $('.img-crop-width-input, .img-crop-height-input').val('');
    jcropApiIns.setImage(imgsrc);
    jcropApiIns.setOptions({ aspectRatio:ratio });
    setTimeout(function(){
      jcropApiIns.setSelect([0,0,300,300]);
    }, 300);
    $('.img-crop-body-left').find('input').eq(0).prop('checked', true).attr('data-ratio', ratio);
    $('#img-crop-box, #img-crop-box-bg').removeClass('animate-hide').addClass('animate-show');
  }

}).on('click', '.box-operation-menu li', function(){
  // 点击我的图片界面操作按钮 展示对应操作
  var $this = $(this),
    selector;

  if(!$('#webapp-img-box .system-img-library').hasClass('active') && 
    $(this).hasClass('cannot-operate-default') && !$this.hasClass('img-batch') && 
    $('#default-img-group:visible').hasClass('active')){
    alertTip('不能删除、编辑默认分组');
    return;
  }
  if(selector = $this.attr('data-href')) {
    $('#img-box-group-create .group-name-input').val('');
    $(selector).removeClass('box-hide').siblings().addClass('box-hide');
  }
  // 编辑组名
  if($this.hasClass('edit-img-group')) {
    $('#img-box-group-edit .group-name-input').val($('#webapp-img-box .webapp-content-tab:visible .active').text());
    return;
  }
  // 批量处理
  if($this.hasClass('img-batch')) {
    var select = '';
    $('#webapp-img-box .webapp-content-tab:visible li').each(function(i, li){
      select += '<option value="'+$(li).attr('data-id')+'">'+$(li).text()+'</option>'
    });
    $('#webapp-img-box .resource-group-select').html(select);
    $('#webapp-img-box .resource-list .selected').removeClass('selected');
    $('#webapp-img-box .resource-select-num').text(0);
    // $('#webapp-img-box .img-box-confirm').hide();
  }

}).on('click', '.group-edit-cancel', function(){
// 点击操作组取消按钮
  $(this).parent().addClass('box-hide');
  $('#webapp-img-box .box-operation-menu').removeClass('box-hide');
  $('#webapp-img-box li.selected').removeClass('selected');
  // $('#webapp-img-box .img-box-confirm').show();

}).on('click', '#img-box-group-edit .group-edit-confirm', function(){
// 确定修改组名
  var $this     = $(this),
      groupName = $this.siblings('.group-name-input').val(),
      $li       = $('#webapp-img-box .webapp-content-tab:visible .active'),
      groupId   = $li.attr('data-id'),
      data      = {
        tag: groupName
        ,tag_id: groupId
      };

  $('#webapp-img-box .system-img-library').hasClass('active') ? (data.admin = 1) : (data.user = 1);
  $.ajax({
    url : '/index.php?r=pc/UserTag/updateTag', 
    type: 'get',
    data: data, 
    dataType: 'json',
    success: function(data){
      if(data.status !== 0) { alertTip(data.data); return; }
      $li.text(groupName);
      $this.siblings('.group-edit-cancel').trigger('click');
    }
  });
}).on('click', '#img-box-group-edit .delete-img-group', function(){
// 删除组
  var $this   = $(this),
      $li     = $('#webapp-img-box .webapp-content-tab:visible .active'),
      groupId = $li.attr('data-id'),
      $content= $li.parent().siblings('.resource-list-wrap').eq($li.index()),
      data = {
        tag_id: groupId
      };

  if(!confirm('删除分组后分组里的图片不会删除，您确定要删除当前组？')) { return; }
  $('#webapp-img-box .system-img-library').hasClass('active') ? (data.admin = 1) : (data.user = 1);
  $.ajax({
    url : '/index.php?r=pc/UserTag/removeTag',
    type: 'get',
    data: data,
    dataType: 'json',
    success: function(data){
      if(data.status !== 0) { alertTip(data.data); return; }
      $li.siblings('li').eq(0).trigger('click');
      $li.remove();
      $content.remove();
      $this.siblings('.group-edit-cancel').trigger('click');
    }
  });
}).on('click', '#img-box-group-create .group-edit-confirm', function(){
// 确定创建分组
  var $this     = $(this),
      groupName = $this.siblings('.group-name-input').val(),
      url       = '/index.php?r=pc/UserTag/addTag', 
      para = {
        tag   : groupName
        ,user : $('#webapp-img-box .system-img-library').hasClass('active') ? 0 : 1
        ,type : 0
      };

  $.ajax({
    url: url,
    type: 'get',
    data: para,
    dataType: 'json',
    success: function(data){
      if(data.status !== 0) { alertTip(data.data); return; }
      var li = '<li data-page="1" data-id="'+data.data+'">'+data.title+'</li>';
      $('#webapp-img-box .webapp-content-tab:visible').append(li).parent()
        .append('<div class="resource-list-wrap"><ul class="resource-list"></ul></div>');
      $this.siblings('.group-edit-cancel').trigger('click');
    }
  });

}).on('click', '#box-img-batch .group-edit-confirm', function(){
// 确定批量移动
  var $this     = $(this),
      imgId     = [],
      imgs      = $('.resource-list:visible .selected'),
      oldGroupId  = $('#webapp-img-box .webapp-content-tab:visible .active').attr('data-id'),
      newGroupId  = $('#webapp-img-box .resource-group-select:visible').val();

  if(oldGroupId == newGroupId) { return; }
  imgs.length && imgs.each(function(index, au){
    imgId.push($(au).attr('data-id'));
  });
  $.ajax({
    url : '/index.php?r=pc/UserTag/moveImg',
    type: 'get',
    data: {
      tag_id: newGroupId
      ,img_arr: imgId
      ,user : $('#webapp-img-box .system-img-library').hasClass('active') ? 0 : 1
    },
    dataType: 'json',
    success: function(data){
      if(data.status !== 0) { alertTip(data.data); return; }
      if($('#webapp-img-box .webapp-content-tab:visible .active').attr('data-id') == 0){
        $('#webapp-img-box .webapp-content-tab:visible .selected').removeClass('selected');
      }else {
        imgs.remove();
      }
      $('#webapp-img-box .webapp-content-tab:visible [data-id="'+newGroupId+'"]').attr('data-page', 1);
      $this.siblings('.group-edit-cancel').trigger('click');
    }
  });
}).on('click', '.delete-select-img', function(){
// 确定批量删除
  var $this = $(this),
      imgs  = $('#webapp-img-box .resource-list:visible .selected'),
      imgId;

  if(!imgs.length) { return; }
  if(!confirm('确定删除所有选中的图片')) { return; }
  imgId = [];

  imgs.each(function(index, au){
    imgId.push($(au).attr('data-id'));
  });
  $.ajax({
    url : '/index.php?r=pc/UserTag/removeImg',
    type: 'post',
    data: {
      tag_id: $('#webapp-img-box .webapp-content-tab:visible .active').attr('data-id')
      ,img_arr: imgId
      ,user: $('#webapp-img-box .system-img-library').hasClass('active') ? 0 : 1
    }, 
    dataType: 'json',
    success: function(data){
      if(data.status !== 0) { alertTip(data.data); return; }
      imgs.remove();
      $this.siblings('.group-edit-cancel').trigger('click');
    }
  });

}).on('click', '.img-operate [data-role="delete"]', function(e){
// 删除图片
  e.stopPropagation();
  var $this = $(this);
  if(!confirm('确定要删除图片？')){ return; }
  $.ajax({
    url: '/index.php?r=pc/UserTag/removeImg',
    type: 'post',
    data: {
      tag_id: $('#webapp-img-box .webapp-content-tab:visible .active').attr('data-id')
      ,img_arr: [$this.closest('li').attr('data-id')]
      ,user: $('#webapp-img-box .system-img-library').hasClass('active') ? 0 : 1
    }, 
    dataType: 'json',
    success: function(data){
      if (data.status !==0) { alertTip(data.data); return; }
      $this.closest('li').remove();
    }
  });

});

// 裁剪
$('#img-crop-box').on('click', '.img-crop-confirm', function(){
// 确定裁剪
  var $this = $(this),
      $targetImg = $('#img-crop-target'),
      target_url = $targetImg.attr("src"),
      target_id  = $targetImg.attr("data-id");

  if(/\.gif/.test(target_url)){
    alertTip("GIF格式的图片无法裁剪");
    return;
  }
  if($this.hasClass('disabled')) { return; }
  $this.addClass('disabled').text("提交中..");
  $.ajax({
    url: '/index.php?r=pc/UserTag/CropImage',
    type: 'post',
    dataType: 'json',
    data: {
      id: target_id,
      orig_file: target_url,
      width: Math.round(jcropSelectPos.w),
      height:Math.round(jcropSelectPos.h),
      x:Math.round(jcropSelectPos.x),
      y:Math.round(jcropSelectPos.y)
    },
    success: function(data){
      $this.removeClass('disabled').text("确定");
      if(data.status !== 0){ alertTip(data.data); return; }
      var info = data.data,
          imgStr = '<li data-id='+info.id+' data-src='+info.img_thumb
                 + '><a href="javascript:;" title="" class="thumbnail"><img src='
                 + info.img_thumb +' alt=""></a><div class="img-operate">'
                 // + '<a href="javascript:;"'
                 // + ' title="移动到其他分组" data-role="move"><span class="glyphicon '
                 // + 'glyphicon-move"></span></a>'
                 // + '<a href="javascript:;" title="裁剪尺寸" data-role="truncate">'
                 // + '<span class="glyphicon glyphicon-edit">裁剪</span></a>'
                 + '<a href="javascript:;" title="删除" data-role="delete"><span class="glyphicon'
                 + ' glyphicon-trash">删除</span></a></div></li>';
      
      $('.resource-list:visible').prepend(imgStr);
      if($img_box_replacer){
        $img_box_replacer.attr('src', info.img_thumb);
      }
      $.isFunction(afterSelectImgCallback) && afterSelectImgCallback(info.img_thumb);
      $('#img-crop-box .webapp-box-close, #webapp-img-box .webapp-box-close').trigger('click');
    },
    error: function() {
      $this.removeClass('disabled').text("确定");
      alertTip('请求出错');
    }
  });

}).on('click', '.img-crop-cancel', function(){
// 不裁剪
  var imgUrl = $('#webapp-img-box .resource-list:visible .selected img').attr('src');
  if($img_box_replacer){
    $img_box_replacer.attr('src', imgUrl);
  }
  $.isFunction(afterSelectImgCallback) && afterSelectImgCallback(imgUrl);
  $('#img-crop-box .webapp-box-close, #webapp-img-box .webapp-box-close').trigger('click');

}).on('blur', '.img-crop-width-input, .img-crop-height-input', function(e){
// 输入裁剪宽高
  // var keycode = e.keyCode;
  // console.log(keycode);
  // if ((48 <= keycode && keycode <= 57) || (96 <= keycode && keycode <= 105) || keycode == 8 || keycode == 46 ){
    var x = jcropSelectPos.x,
        y = jcropSelectPos.y,
        width = +$('.img-crop-width-input').val()+x,
        height= +$('.img-crop-height-input').val()+y;

    // img_box_inputTimer && clearTimeout(img_box_inputTimer);
    $('.img-box-ui-radio').last().prop('checked', true);
    jcropApiIns.setOptions({aspectRatio: 0});
    // img_box_inputTimer = setTimeout(function(){
      jcropApiIns.setSelect([x, y, width, height]);
  //   }, 1000);

  // } else {
  //   e.preventDefault();
  // }
}).on('click', '.webapp-box-close, .img-crop-return', function(){
// 关闭剪裁框
  $('#img-crop-box, #img-crop-box-bg').addClass('animate-hide').removeClass('animate-show');

}).on('click', '.img-crop-body-left input', function(){
// 修改裁剪比例
  jcropApiIns.setOptions({aspectRatio: eval($(this).attr('data-ratio'))});
});

function webappImgBoxScroll(list_wrap){
  var $this = list_wrap,
      scrollTop, wrapHeight, contentH;

  if(img_box_scrollTimer){ return; }
  img_box_scrollTimer = setTimeout(function(){
    scrollTop  = $this.scrollTop();
    wrapHeight = $this.height();
    contentH   = $this.children('ul').height();
    if(wrapHeight + scrollTop >= contentH){
      getImgResource('image', 
        $('.webapp-sub-cate:visible .active').length 
        ? $('.webapp-sub-cate:visible .active') 
        : $('#webapp-img-box .webapp-content-tab:visible .active'), 
      $('#webapp-img-box .resource-list:visible'));
    }
    img_box_scrollTimer = 0;
  }, 100);
}

// 注册图片上传插件
ImgUploader('#select-local-img');
function ImgUploader(id) {
  var fileId, uploader, $current_progress,
      FILE_SIZE_LIMIT = 1024 * 1024 * 2;

  uploader = WebUploader.create({
    accept: {
      extensions: 'gif,jpg,jpeg,bmp,png',
      mimeTypes: 'image/gif,image/jpg,image/jpeg,image/bmp,image/png'
    },
    compress: {
      width: 1600,
      height: 1600,
      // 图片质量，只有type为`image/jpeg`的时候才有效。
      quality: 90,
      // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.
      allowMagnify: false,
      // 是否允许裁剪。
      crop: false,
      // 是否保留头部meta信息。
      preserveHeaders: true,
      // 如果发现压缩后文件大小比原来还大，则使用原来图片
      // 此属性可能会影响图片自动纠正功能
      noCompressIfLarger: false,
      // 单位字节，如果图片大小小于此值，不会采用压缩。
      compressSize: 0
    },
    // fileNumLimit: 10, // 验证文件总数量, 超出则不允许加入队列
    auto: true,
    fileSingleSizeLimit: FILE_SIZE_LIMIT, //文件大小为2M
    // swf文件路径
    swf: './Uploader.swf',
    // 文件接收服务端。
    server: '/index.php?r=pc/UserTag/addimg',
    // 允许重复上传
    duplicate: true,
    // 选择文件的按钮。可选。
    // 内部根据当前运行时创建，可能是input元素，也可能是flash.
    pick: id
  });
  // 当有文件添加进来的时候
  uploader.on('filesQueued', function(files) {
    var list = '';

    $.each(files, function(index, file){
      list += '<li class="resource-uploading" data-name="'+file.name+'" data-id="'+file.id+'">'
            + '<a href="javascript:;" title="" class="thumbnail"><img></a>'
            // + '<h5 class="img-title">'+file.name+'</h5>'
            + '<div class="img-operate">'
            // + '<a href="javascript:;" title="移动到其他分组" data-role="move"><span class="glyphicon glyphicon-move"></span></a>'
            // + '<a href="javascript:;" title="裁剪尺寸" data-role="truncate"><span class="glyphicon glyphicon-edit">裁剪</span></a>'
            + '<a href="javascript:;" title="删除" data-role="delete"><span class="glyphicon glyphicon-trash">删除</span></a></div>'
            + '<div class="progress-mask"><p class="progress-inner"></p><p class="upload-fail-tip">上传失败</p></div></li>';
    });
    $('.resource-list:visible').prepend(list);
  });
  uploader.on('startUpload', function(file, percentage) {
    // 开始上传流程触发
    var user = $('#webapp-img-box .webapp-box-header-ul .active').hasClass('system-img-library') ? 0 : 1,
        tag = $('#webapp-img-box .webapp-content-tab:visible .active').attr('data-id') || 0;
    uploader.option('server', '/index.php?r=pc/UserTag/addimg&user='+ user +'&tag_id=' + tag);
  });
  uploader.on('uploadStart', function(file){
    $current_progress = $('.resource-list:visible li[data-id="'+file.id+'"] .progress-inner');
  });
  uploader.on('uploadProgress', function(file, percentage) {
    $current_progress.text(Math.round(percentage*100)+'%');
  });
  uploader.on('uploadSuccess', function(file, response) {
    var fileId  = file.id,
        $li     = $('.resource-list:visible li[data-id="'+fileId+'"]');

    if(response.status !== 0) {
      $li.find('.upload-fail-tip').show().siblings('.progress-bar').hide();
      return;
    }
    $li.closest('.resource-list-wrap').scrollTop(0);
    $li.attr({ 'data-id': response.data.id, 'data-src': response.data.img_original })
       .removeClass('resource-uploading')
       .find('.progress-mask').remove();
    $li.find('img').attr('src', response.data.img_original);
  });
  uploader.on('uploadError', function(file) {
    var fileId  = file.id,
      $li   = $('#webapp-img-box .resource-list:visible li[data-id="'+fileId+'"]');

    $li.attr('upload-fail', 1).find('.upload-fail-tip').show().siblings('.progress-inner').hide();
  });
  uploader.on('uploadFinished', function() {
    // 所有文件结束上传
    $('#webapp-img-box .resource-list:visible li[upload-fail="1"]').remove();
  });
  uploader.on('error', function(type) {
    if(type === 'Q_TYPE_DENIED'){
      alert('请上传 gif/jpg/jpeg/bmp/png 格式的文件');
    } else if(type === 'Q_EXCEED_NUM_LIMIT'){
      alert('选择的文件数目超出限制 超出部分已取消上传');
    } else if(type === 'Q_EXCEED_SIZE_LIMIT '){
      alert('添加的文件总大小超出限制 超出部分已取消上传');
    }
  });
  uploader.on('beforeFileQueued', function(file){
    if(file.size > FILE_SIZE_LIMIT){
      alert('文件大小超出'+ (FILE_SIZE_LIMIT/1024/1024) +'M限制');
      return false;
    }
  });
}

function showImgResourceBox(img, afterCallback){
  $img_box_replacer = $(img) || '';
  afterSelectImgCallback = afterCallback || '';

  if($('#webapp-img-box').hasClass('img-resource-loaded')){
    $('#webapp-img-box .resource-list .selected').removeClass('selected');
    $('#webapp-img-box-bg, #webapp-img-box').removeClass('animate-hide').addClass('animate-show');
    return;
  }

  // 第一次打开图片资源框 加载默认分组图片
  $.ajax({
    url: '/index.php?r=pc/UserTag/getTagList', 
    type: 'get',
    data: {
      type: 0
    },
    dataType: 'json',
    success:  function(data){
      if(data.status !== 0) { alertTip(data.data); return; }
      var taglist = data.data.user_list,
          tab = content_wrap = '',
          wrap_template = '<div class="resource-list-wrap"><ul class="resource-list"></ul></div>';

      taglist.length && $.each(taglist, function(index, tag){
        tab += '<li data-id="'+tag.id+'" data-page="1">'+tag.title+'</li>';
        content_wrap += wrap_template;
      });
      $('#webapp-my-img .webapp-content-tab').append(tab).parent().append(content_wrap);

      $('#webapp-img-box').addClass('img-resource-loaded');
      $('#webapp-img-box .resource-list .selected').removeClass('selected');
      $('#webapp-img-box-bg, #webapp-img-box').removeClass('animate-hide').addClass('animate-show');
      if (!(list = $('#webapp-img-box .webapp-box-header-ul:visible li')).find('.active').length){
        list.eq(0).trigger('click');
      }

      $.ajax({
        url: '/index.php?r=pc/InvitationData/GetCategory', 
        type: 'get',
        data: { type : 2 },
        dataType: 'json',
        success: function(data) {
          if (data.status !== 0) { alertTip(data.data); return; }
          var subCate = '';

          taglist = data.data;
          tab = content_wrap = '';
          taglist.length && $.each(taglist, function(index, tag){
            tab += '<li data-id="'+tag.cate_id+'" data-page="1">'+tag.name+'</li>';
            if(tag.cate.length) {
              subCate += '<div class="webapp-sub-cate" data-href='+tag.cate_id
                       + '><span data-id='+tag.cate_id+' data-page="1">全部</span>';
              $.each(tag.cate, function(key, cate){
                subCate += '<span data-id='+cate.cate_id+' data-page="1">'+cate.name+'</span>';
              });
              subCate += '</div>';
            }
            content_wrap += wrap_template;
          });
          $('#webapp-system-img .webapp-content-tab').append(tab).after(subCate + content_wrap);
          $('#webapp-img-box .resource-list-wrap').on('scroll', function(){
            webappImgBoxScroll($(this));
          });
        }
      });
    }
  });
}
// 获取资源框内容
function getImgResource(type, $clickTab, $ul){
  var page = Number($clickTab.attr('data-page')),
      para = {
        tag_id: $clickTab.attr('data-id')
        ,page: page
        ,page_size: 20
        ,user: $('#webapp-img-box .system-img-library').hasClass('active') ? 0 : 1
      };

  $.ajax({
    url: '/index.php?r=pc/UserTag/getImgList', 
    type: 'get',
    data: para,
    dataType: 'json',
    success: function(data){
      if(data.status !== 0) { alertTip(data.data); return; }
      var list = data.data,
          html = '';
      list.length && $.each(list, function(i, item){
        if ( type === 'audio'){
          html += '<li data-id="'+item.id+'" data-src="'+item.music+'"><span class="resource-name">'+item.title
              + '</span><div class="audio-play-pause"><i class="resource-audio-play">播放 </i><i class="resource-audio-pause">'
              + '暂停</i></div><div class="resource-remove"><span>×</span><div></li>';
        
        } else if (type === 'image') {
          html += '<li data-id="'+item.id+'" data-src="'+item.img_original+'">'
              + '<a href="javascript:;" title="" class="thumbnail"><img src="'
              + item.img_original +'"></a>'
              // + '<h5 class="img-title">'+item.name+'</h5>'
              + '<div class="img-operate">'
              // + '<a href="javascript:;" title="移动到其他分组" data-role="move"><span class="glyphicon glyphicon-move"></span></a>'
              // + '<a href="javascript:;" title="裁剪尺寸" data-role="truncate"><span class="glyphicon glyphicon-edit">裁剪</span></a>'
              + '<a href="javascript:;" title="删除" data-role="delete"><span class="glyphicon glyphicon-trash">删除</span></a></div></li>';
        }
      });
      page == 1 ? $ul.html(html) : $ul.append(html);
      $clickTab.attr('data-page', ++page);
      if (data.current_page >= data.total_page){
        $ul.parent().off('scroll');
      }
    }
  });
}

</script>
</body>
</html>